<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Street Cricket Scorer</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-gray-200">
<div id="root"></div>

<script type="text/babel">
const { jsPDF } = window.jspdf;

function App() {
  /* ===== SERIES ===== */
  const [seriesType, setSeriesType] = React.useState("single"); // single | bo3 | bo5
  const [series, setSeries] = React.useState(
    JSON.parse(localStorage.getItem("series")) || { A:0, B:0, played:0 }
  );

  /* ===== MATCH ===== */
  const [screen, setScreen] = React.useState("setup");
  const [teamA, setTeamA] = React.useState("Team A");
  const [teamB, setTeamB] = React.useState("Team B");
  const [squadA, setSquadA] = React.useState(["","",""]);
  const [squadB, setSquadB] = React.useState(["","",""]);

  const [innings, setInnings] = React.useState(1);
  const [target, setTarget] = React.useState(null);
  const maxOvers = 2; // street cricket demo

  const [runs, setRuns] = React.useState(0);
  const [balls, setBalls] = React.useState(0);
  const [wickets, setWickets] = React.useState(0);

  const [striker, setStriker] = React.useState("");
  const [nonStriker, setNonStriker] = React.useState("");

  /* ===== PARTNERSHIP ===== */
  const [pRuns, setPRuns] = React.useState(0);
  const [pBalls, setPBalls] = React.useState(0);

  /* ===== MODALS ===== */
  const [showNB, setShowNB] = React.useState(false);
  const [showOut, setShowOut] = React.useState(false);

  const overs = Math.floor(balls/6) + balls%6/10;
  const oversLeft = maxOvers - overs;
  const reqRR = innings === 2 && oversLeft > 0
    ? ((target - runs) / oversLeft).toFixed(2)
    : null;

  function swapStrike() {
    setStriker(nonStriker);
    setNonStriker(striker);
  }

  function scoreRun(r) {
    setRuns(runs + r);
    setBalls(balls + 1);
    setPRuns(pRuns + r);
    setPBalls(pBalls + 1);
    if (r % 2 === 1) swapStrike();
    if ((balls + 1) % 6 === 0) swapStrike();
  }

  function noBall(extra) {
    setRuns(runs + 1 + extra);
    setPRuns(pRuns + extra);
    if (extra % 2 === 1) swapStrike();
    setShowNB(false);
  }

  function wicket() {
    setWickets(wickets + 1);
    setBalls(balls + 1);
    setPRuns(0);
    setPBalls(0);
    setStriker("New Batsman");
    setShowOut(false);
  }

  function endInnings() {
    if (innings === 1) {
      setTarget(runs + 1);
      setRuns(0);
      setBalls(0);
      setWickets(0);
      setInnings(2);
      setStriker(squadB[0]);
      setNonStriker(squadB[1]);
      setPRuns(0);
      setPBalls(0);
    } else {
      finishMatch();
    }
  }

  function finishMatch() {
    const winner =
      runs >= target ? "B" : "A";

    const updated = {
      ...series,
      [winner]: series[winner] + 1,
      played: series.played + 1
    };
    setSeries(updated);
    localStorage.setItem("series", JSON.stringify(updated));
    setScreen("setup");
  }

  /* ===== SETUP ===== */
  if (screen === "setup") {
    return (
      <div className="min-h-screen flex justify-center">
        <div className="w-full max-w-md bg-white p-4 space-y-4">
          <h1 className="text-xl font-bold text-center">Start Match</h1>

          <select className="border p-2 w-full"
            value={seriesType}
            onChange={e=>setSeriesType(e.target.value)}>
            <option value="single">Single Match</option>
            <option value="bo3">Best of 3</option>
            <option value="bo5">Best of 5</option>
          </select>

          <p className="text-sm text-gray-600 text-center">
            Series: {teamA} {series.A} â€“ {series.B} {teamB}
          </p>

          <input className="border p-2 w-full" value={teamA} onChange={e=>setTeamA(e.target.value)} />
          {squadA.map((p,i)=>(
            <input key={i} className="border p-2 w-full"
              placeholder={`A Player ${i+1}`}
              value={p}
              onChange={e=>{const c=[...squadA];c[i]=e.target.value;setSquadA(c);}} />
          ))}

          <input className="border p-2 w-full" value={teamB} onChange={e=>setTeamB(e.target.value)} />
          {squadB.map((p,i)=>(
            <input key={i} className="border p-2 w-full"
              placeholder={`B Player ${i+1}`}
              value={p}
              onChange={e=>{const c=[...squadB];c[i]=e.target.value;setSquadB(c);}} />
          ))}

          <button className="w-full bg-teal-600 text-white py-2"
            onClick={()=>{
              setStriker(squadA[0]);
              setNonStriker(squadA[1]);
              setRuns(0); setBalls(0); setWickets(0);
              setPRuns(0); setPBalls(0);
              setInnings(1);
              setTarget(null);
              setScreen("scoring");
            }}>
            Start Match
          </button>
        </div>
      </div>
    );
  }

  /* ===== SCORING ===== */
  return (
    <div className="min-h-screen bg-black text-white flex justify-center">
      <div className="w-full max-w-md">

        <div className="bg-red-600 p-3 text-center">
          Innings {innings} {target && `(Target ${target})`}
        </div>

        <div className="p-4 text-center bg-gray-900">
          <h2 className="text-4xl">{runs}/{wickets}</h2>
          <p className="text-sm text-gray-400">
            Overs: {overs.toFixed(1)}
          </p>
          <p className="text-sm text-green-400">
            Partnership: {pRuns} ({pBalls} balls)
          </p>
          {reqRR && (
            <p className="text-sm text-yellow-400">
              Req RR: {reqRR}
            </p>
          )}
        </div>

        <div className="grid grid-cols-3 bg-white text-black">
          {[0,1,2,3,4,6].map(r=>(
            <button key={r} onClick={()=>scoreRun(r)}
              className="py-6 border text-xl font-bold">
              {r===4?"FOUR":r===6?"SIX":r}
            </button>
          ))}
          <button onClick={()=>setShowNB(true)}
            className="py-6 border bg-green-500 text-white">NB</button>
          <button onClick={()=>setShowOut(true)}
            className="py-6 border bg-red-500 text-white">OUT</button>
        </div>

        {showNB && (
          <div className="fixed inset-0 bg-black/70 flex items-center justify-center">
            <div className="bg-white p-4">
              {[0,1,2,3,4,6].map(r=>(
                <button key={r} onClick={()=>noBall(r)}
                  className="m-1 px-3 py-2 border">{r}</button>
              ))}
            </div>
          </div>
        )}

        {showOut && (
          <div className="fixed inset-0 bg-black/70 flex items-center justify-center">
            <div className="bg-white p-4">
              <button onClick={wicket} className="w-full border py-2">
                Wicket
              </button>
            </div>
          </div>
        )}

        <button onClick={endInnings}
          className="w-full py-3 bg-blue-600 mt-2">
          End Innings / Match
        </button>

      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
