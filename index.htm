<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Street Cricket Scorer</title>

<!-- version: 2026-01-06 -->

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-gray-200">
<div id="root"></div>

<script type="text/babel">
const { jsPDF } = window.jspdf;

const MATCH_KEY = "sc_match";
const CAREER_KEY = "sc_career";

function App() {
  /* ================= LOAD ================= */
  const saved = JSON.parse(localStorage.getItem(MATCH_KEY));
  const career = JSON.parse(localStorage.getItem(CAREER_KEY)) || {};

  /* ================= RULES ================= */
  const MAX_BALLS = 90;
  const MAX_WICKETS = 2;

  /* ================= CORE ================= */
  const [screen, setScreen] = React.useState(saved ? "scoring" : "setup");
  const [teamA, setTeamA] = React.useState(saved?.teamA || "Team A");
  const [teamB, setTeamB] = React.useState(saved?.teamB || "Team B");
  const [squadA, setSquadA] = React.useState(saved?.squadA || ["","",""]);
  const [squadB, setSquadB] = React.useState(saved?.squadB || ["","",""]);

  const [tossWinner, setTossWinner] = React.useState(saved?.tossWinner || null);
  const [tossDecision, setTossDecision] = React.useState(saved?.tossDecision || null);

  const [innings, setInnings] = React.useState(saved?.innings || 1);
  const [firstInningsScore, setFirstInningsScore] = React.useState(saved?.firstInningsScore || null);

  const [runs, setRuns] = React.useState(saved?.runs || 0);
  const [balls, setBalls] = React.useState(saved?.balls || 0);
  const [wickets, setWickets] = React.useState(saved?.wickets || 0);

  const [battingTeam, setBattingTeam] = React.useState(saved?.battingTeam || null);
  const [bowlingTeam, setBowlingTeam] = React.useState(saved?.bowlingTeam || null);

  const [matchEnded, setMatchEnded] = React.useState(saved?.matchEnded || false);
  const [resultText, setResultText] = React.useState(saved?.resultText || "");

  /* ================= SAVE ================= */
  React.useEffect(() => {
    localStorage.setItem(MATCH_KEY, JSON.stringify({
      teamA, teamB, squadA, squadB,
      tossWinner, tossDecision,
      innings, firstInningsScore,
      runs, balls, wickets,
      battingTeam, bowlingTeam,
      matchEnded, resultText
    }));
  }, [
    teamA, teamB, squadA, squadB,
    tossWinner, tossDecision,
    innings, firstInningsScore,
    runs, balls, wickets,
    battingTeam, bowlingTeam,
    matchEnded, resultText
  ]);

  /* ================= LOGIC ================= */
  function toss() {
    setTossWinner(Math.random() < 0.5 ? teamA : teamB);
  }

  function decide(choice) {
    setTossDecision(choice);
    if (choice === "Bat") {
      setBattingTeam(tossWinner);
      setBowlingTeam(tossWinner === teamA ? teamB : teamA);
    } else {
      setBattingTeam(tossWinner === teamA ? teamB : teamA);
      setBowlingTeam(tossWinner);
    }
  }

  function score(r) {
    if (matchEnded) return;
    if (balls >= MAX_BALLS || wickets >= MAX_WICKETS) return;

    const newRuns = runs + r;
    const newBalls = balls + 1;

    setRuns(newRuns);
    setBalls(newBalls);

    if (innings === 2 && newRuns > firstInningsScore) {
      endMatch(newRuns);
    }

    if (newBalls >= MAX_BALLS) endInnings();
  }

  function out() {
    if (matchEnded) return;
    const w = wickets + 1;
    setWickets(w);
    setBalls(balls + 1);
    if (w >= MAX_WICKETS) endInnings();
  }

  function endInnings() {
    if (innings === 1) {
      setFirstInningsScore(runs);
      setRuns(0);
      setBalls(0);
      setWickets(0);
      setInnings(2);
      setBattingTeam(bowlingTeam);
      setBowlingTeam(battingTeam);
    } else {
      endMatch(runs);
    }
  }

  function endMatch(finalRuns) {
    setMatchEnded(true);
    let res =
      finalRuns > firstInningsScore
        ? `${battingTeam} won`
        : finalRuns < firstInningsScore
        ? `${bowlingTeam} won`
        : "Match Drawn";
    setResultText(res);
    updateCareer(finalRuns);
  }

  function updateCareer(finalRuns) {
    const updated = { ...career };
    const team = battingTeam === teamA ? squadA : squadB;
    team.forEach(p => {
      if (!p) return;
      if (!updated[p]) updated[p] = { runs: 0, balls: 0, matches: 0 };
      updated[p].runs += finalRuns;
      updated[p].matches += 1;
    });
    localStorage.setItem(CAREER_KEY, JSON.stringify(updated));
  }

  function pdf() {
    const d = new jsPDF();
    d.text(`${teamA} vs ${teamB}`, 10, 10);
    d.text(`Toss: ${tossWinner} chose ${tossDecision}`, 10, 20);
    d.text(`Innings 1: ${firstInningsScore}`, 10, 30);
    d.text(`Innings 2: ${runs}`, 10, 40);
    d.text(`Result: ${resultText}`, 10, 50);
    d.save("match-summary.pdf");
  }

  /* ================= UI ================= */
  if (screen === "setup") {
    return (
      <div className="p-4 max-w-md mx-auto bg-white space-y-2">
        <h1 className="font-bold text-center">Match Setup</h1>
        <input value={teamA} onChange={e=>setTeamA(e.target.value)} className="border p-2 w-full"/>
        {squadA.map((p,i)=>(
          <input key={i} value={p} onChange={e=>{const c=[...squadA];c[i]=e.target.value;setSquadA(c);}}
            className="border p-2 w-full" placeholder={`A${i+1}`}/>
        ))}
        <input value={teamB} onChange={e=>setTeamB(e.target.value)} className="border p-2 w-full"/>
        {squadB.map((p,i)=>(
          <input key={i} value={p} onChange={e=>{const c=[...squadB];c[i]=e.target.value;setSquadB(c);}}
            className="border p-2 w-full" placeholder={`B${i+1}`}/>
        ))}
        {!tossWinner && <button onClick={toss} className="bg-blue-600 text-white w-full py-2">Toss</button>}
        {tossWinner && !tossDecision && (
          <>
            <p className="text-center">{tossWinner} won toss</p>
            <button onClick={()=>decide("Bat")} className="bg-green-600 text-white w-full py-2">Bat</button>
            <button onClick={()=>decide("Bowl")} className="bg-red-600 text-white w-full py-2">Bowl</button>
          </>
        )}
        {battingTeam && <button onClick={()=>setScreen("scoring")} className="bg-black text-white w-full py-2">Start</button>}
      </div>
    );
  }

  return (
    <div className="p-4 bg-black text-white min-h-screen">
      <h2 className="text-center text-2xl">{runs}/{wickets}</h2>
      <div className="grid grid-cols-3 bg-white text-black">
        {[0,1,2,3,4,6].map(r=>(
          <button key={r} onClick={()=>score(r)} className="py-6 border">{r}</button>
        ))}
        <button onClick={out} className="bg-red-500 text-white py-6">OUT</button>
      </div>

      {matchEnded && (
        <>
          <div className="bg-green-600 text-center p-2 mt-2">{resultText}</div>
          <button onClick={pdf} className="bg-blue-600 w-full py-2 mt-2">Download PDF</button>
        </>
      )}

      <button onClick={()=>{localStorage.clear();location.reload();}}
        className="bg-red-800 w-full py-2 mt-2">Reset</button>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
