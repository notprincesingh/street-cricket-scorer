<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Street Cricket Scorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-white text-gray-900">
  <div id="root"></div>

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>

  <script type="text/babel">
    const { jsPDF } = window.jspdf;

    function App() {
      const emptyPlayer = () => ({
        runs: 0,
        balls: 0,
        wickets: 0,
        matches: 0
      });

      const [playersA, setPlayersA] = React.useState(["", "", ""]);
      const [playersB, setPlayersB] = React.useState(["", "", ""]);

      const [career, setCareer] = React.useState(
        JSON.parse(localStorage.getItem("careerStats") || "{}")
      );

      const [innings, setInnings] = React.useState(1);
      const [batting, setBatting] = React.useState("A");
      const [runs, setRuns] = React.useState(0);
      const [balls, setBalls] = React.useState(0);
      const [wickets, setWickets] = React.useState(0);

      const striker = batting === "A" ? playersA[0] : playersB[0];

      function updateCareer(player, addRuns, addBalls, addWicket=false) {
        const updated = {...career};
        if (!updated[player]) updated[player] = emptyPlayer();
        updated[player].runs += addRuns;
        updated[player].balls += addBalls;
        if (addWicket) updated[player].wickets += 1;
        localStorage.setItem("careerStats", JSON.stringify(updated));
        setCareer(updated);
      }

      function scoreRun(r) {
        setRuns(runs + r);
        setBalls(balls + 1);
        updateCareer(striker, r, 1);
      }

      function noBall(batRuns) {
        setRuns(runs + batRuns + 1);
        updateCareer(striker, batRuns, 0);
      }

      function wicket(type) {
        setWickets(wickets + 1);
        setBalls(balls + 1);
        updateCareer(striker, 0, 1, true);
      }

      function exportPDF() {
        const doc = new jsPDF();
        doc.text("Street Cricket Match Summary", 10, 10);
        doc.text(`Innings: ${innings}`, 10, 20);
        doc.text(`Runs: ${runs}`, 10, 30);
        doc.text(`Wickets: ${wickets}`, 10, 40);
        doc.save("match-summary.pdf");
      }

      return (
        <div className="max-w-xl mx-auto p-4 space-y-4">
          <h1 className="text-3xl font-bold text-blue-600">Street Cricket Scorer</h1>

          <div>
            <h2 className="font-semibold">Team A</h2>
            {playersA.map((p,i)=>(
              <input key={i} className="border p-1 w-full mb-1"
                placeholder={`Player ${i+1}`}
                value={p}
                onChange={e=>{
                  const n=[...playersA]; n[i]=e.target.value; setPlayersA(n);
                }}
              />
            ))}
          </div>

          <div>
            <h2 className="font-semibold">Team B</h2>
            {playersB.map((p,i)=>(
              <input key={i} className="border p-1 w-full mb-1"
                placeholder={`Player ${i+1}`}
                value={p}
                onChange={e=>{
                  const n=[...playersB]; n[i]=e.target.value; setPlayersB(n);
                }}
              />
            ))}
          </div>

          <div className="bg-gray-100 p-3 rounded">
            <p><b>Innings:</b> {innings}</p>
            <p><b>Runs:</b> {runs} / {wickets}</p>
            <p><b>Overs:</b> {Math.floor(balls/6)}.{balls%6}</p>
          </div>

          <div className="grid grid-cols-3 gap-2">
            {[0,1,2,3,4,6].map(r=>(
              <button key={r} className="bg-blue-500 text-white p-2 rounded"
                onClick={()=>scoreRun(r)}>{r}</button>
            ))}
          </div>

          <div className="flex gap-2">
            <button className="bg-green-600 text-white p-2 rounded"
              onClick={()=>noBall(0)}>No Ball</button>
            <button className="bg-red-600 text-white p-2 rounded"
              onClick={()=>wicket("Bowled")}>Wicket</button>
          </div>

          <button className="bg-black text-white p-2 rounded"
            onClick={exportPDF}>
            Export PDF
          </button>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
